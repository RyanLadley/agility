var app=angular.module("app",["ngRoute","ngCookies"],["$locationProvider",function(a){a.html5Mode(!0)}]);app.run(["$rootScope","$location","$cookies",function(a,b,c){a.$watchCollection(function(){return c.getObject("token")},function(e){null==e?(a.isSignedIn=!1,"/login"!==b.path()&&(alert("You have been logged out!"),b.url("/login"))):(a.isSignedIn=!0,d(c.get("project")))}),a.$on("$routeChangeStart",function(c,d,e){a.isSignedIn||b.url("/login")});var d=function(a){console.log(a),a||"/select/project"===b.path()||"/create/project"===b.path()||(console.log("/create/project"!==b.path()),b.url("/select/project"))}}]),app.service("postRequestService",["$http","$cookies",function(a,b){this.request=function(c,d){var e=new FormData;return e.append("payload",JSON.stringify(d)),e.append("token",JSON.stringify(b.getObject("token"))),a.post(c,e,{withCredentials:!1,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(a){if("success"===a.data.status){var c=new Date,d=new Date(c.getFullYear()+1,c.getMonth(),c.getDate());b.putObject("token",a.data.token,{expires:d})}else if("Project Access Denied"===a.data.response){var c=new Date,d=new Date(c.getFullYear()+1,c.getMonth(),c.getDate());b.putObject("token",a.data.token,{expires:d}),b.remove("project")}else"Invalid User"===a.data.response&&b.remove("token");return a},function(a){"Invalid User"===a.data.response&&b.remove("token")})}}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{controller:"homeController",templateUrl:"/res/site/home/home.index.html"}).when("/list/sprint/current",{controller:"sprintController",templateUrl:"/res/site/sprint/sprint.index.html"}).when("/list/epics",{controller:"epicListingController",templateUrl:"/res/site/epic-listing/epic-listing.index.html"}).when("/card/:cardId",{controller:"cardDetailsController",templateUrl:"/res/site/card-details/card-details.index.html"}).when("/create/card/:cardType",{controller:"createCardController",templateUrl:"/res/site/create/create-card.index.html"}).when("/list/backlog",{controller:"backlogController",templateUrl:"/res/site/backlog/backlog.index.html"}).when("/list/archive",{controller:"archiveController",templateUrl:"/res/site/archive/archive.index.html"}).when("/select/project",{controller:"selectProjectController",templateUrl:"/res/site/select-project/select-project.index.html"}).when("/create/project",{controller:"createProjectController",templateUrl:"/res/site/create/create-project.index.html"}).when("/login",{controller:"adminController",templateUrl:"/res/site/admin/login.index.html"}).otherwise("/",{redirectTo:"/"})}]),app.controller("addCardToSprintController",["$scope","$location","$route","$cookies","postRequestService",function(a,b,c,d,e){e.request("/api/cards/get/backlog/project/"+d.get("project")).then(function(b){console.log(b),a.availableCards=b.data.response}),a.cancel=function(){c.reload()},a.cardId="",a.add=function(){api_url="/api/sprint/"+a.sprint.id+"/add/card/"+a.cardId,e.request(api_url).then(function(a){c.reload()})}}]),app.controller("adminController",["$scope","$rootScope","$location",function(a,b,c){b.isSignedIn&&c.url("/")}]),app.controller("archiveController",["$scope","$location","$cookies","postRequestService",function(a,b,c,d){d.request("/api/cards/get/archive/project/"+c.get("project")).then(function(b){a.archive=b.data.response}),a.viewCard=function(a){b.url("/card/"+a)}}]),app.controller("backlogController",["$scope","$location","$cookies","postRequestService",function(a,b,c,d){d.request("/api/cards/get/backlog/project/"+c.get("project")).then(function(b){a.backlog=b.data.response}),a.viewCard=function(a){b.url("/card/"+a)}}]),app.controller("cardDetailsController",["$scope","$routeParams","$cookies","postRequestService",function(a,b,c,d){var e="/api/get/card/"+b.cardId+"/project/"+c.get("project");d.request(e).then(function(b){a.card=b.data.response}),a.editName=!1,a.toggleEditName=function(){a.updatedName={cardId:a.card.id,cardName:a.card.name},a.editName=!a.editName},a.saveName=function(){var b="/api/card/"+a.card.id+"/update/name";d.request(b,a.updatedName).then(function(b){a.card.name=b.data.response.name,a.editName=!1})},a.editDetails=!1,a.toggleEditDetails=function(){h(),f(),a.editDetails=!a.editDetails};var f=function(){var b;b="None"==a.card.points?null:parseInt(a.card.points),a.updatedDetails={cardId:a.card.id,cardType:a.card.type,epicId:a.card.epic.id,cardCreated:a.card.created,cardUpdated:a.card.updated,cardPoints:b,userId:a.card.poc.id,cardStatus:a.card.status}};a.saveDetails=function(){var b="/api/card/"+a.card.id+"/update/details";d.request(b,a.updatedDetails).then(function(b){var c=b.data.response;a.card.epic=c.epic,a.card.created=c.created,a.card.updated=c.updated,a.card.points=c.points,a.card.poc=c.poc,a.card.status=c.status,a.editDetails=!1})},a.editDescription=!1,a.toggleEditDescription=function(){a.updatedDescription={cardId:a.card.id,cardDescription:a.card.description},a.editDescription=!a.editDescription},a.saveDescription=function(){var b="/api/card/"+a.card.id+"/update/description";d.request(b,a.updatedDescription).then(function(b){a.card.description=b.data.response.description,a.editDescription=!1})},a.editSteps=!1,a.toggleEditSteps=function(){h(),g(),a.editSteps=!a.editSteps};var g=function(){for(a.updatedSteps=[],i=0;i<a.card.steps.length;i++)a.updatedSteps.push({stepId:a.card.steps[i].id,stepTask:a.card.steps[i].task,userId:a.card.steps[i].assigned.id,stepStatus:a.card.steps[i].status})};a.saveSteps=function(){var b="/api/card/"+a.card.id+"/update/steps";d.request(b,a.updatedSteps).then(function(b){a.card.steps=b.data.response,a.editSteps=!1})};var h=function(){a.users&&a.statuses&&a.epic||(a.epics=[a.card.epic],d.request("/api/page/create/card/project/"+c.get("project")).then(function(b){a.statuses=b.data.response.statuses,unassigned=[{id:0,first_name:"Unassigned"}],a.users=unassigned.concat(b.data.response.users),a.epics=b.data.response.epics}))}}]),app.controller("cardController",["$scope",function(a){a.front=!0,a.toggleShow=function(){a.front=!a.front}}]),app.controller("createCardController",["$scope","$routeParams","$cookies","$location","postRequestService",function(a,b,c,d,e){a.newCard={cardProject:c.get("project"),cardIndex:"",cardName:"",cardType:b.cardType,cardCreated:new Date,cardUpdated:new Date,cardPoints:"",userId:0,cardStatus:"Open",cardDescription:"",epicId:"0",epicBackgroundColor:"#ffffff",epicForegroundColor:"#000000",steps:[]},a.epic={id:0},a.$watch("newCard.epicBackgroundColor",function(b){"Epic"==a.newCard.cardType&&(a.epics[0].background_color=b)}),a.$watch("newCard.epicForegroundColor",function(b){"Epic"==a.newCard.cardType&&(a.epics[0].foreground_color=b)}),a.$watch("newCard.cardName",function(b){"Epic"==a.newCard.cardType&&(a.epics[0].name=b)}),a.$watch(a.epic,function(){a.newCard.epicId=a.epic.id}),a.epics=[{id:0,name:"None"}],e.request("/api/page/create/card/project/"+c.get("project")).then(function(b){a.newCard.cardIndex=b.data.response.card_index,a.statuses=b.data.response.statuses,unassigned=[{id:0,first_name:"Unassigned"}],a.users=unassigned.concat(b.data.response.users),a.newCard.cardPoc=0,a.epics=a.epics.concat(b.data.response.epics)}),a.createCard=function(){e.request("/api/create/card",a.newCard).then(function(b){d.url("/card/"+a.newCard.cardIndex)})}}]),app.controller("createProjectController",["$scope","$location","$cookies","postRequestService",function(a,b,c,d){a.project={create:!0,name:"New Project",designator:"PROJ",image:"/image/project/0/default.jpg"},a.apiImage,a.uploadImage=function(b){a.apiImage=b.files;var c=new FileReader;c.onload=function(b){a.project.image=b.target.result,a.$apply()},c.readAsDataURL(b.files)},a.submit=function(){var e={projName:a.project.name,projDesignator:a.project.designator,image:a.project.image};d.request("/api/project/create",e).then(function(a){projectId=a.data.response;var d=new Date,e=new Date(d.getFullYear()+1,d.getMonth(),d.getDate());c.put("project",projectId,{expires:e}),b.url("/")})}}]),app.controller("epicListingController",["$scope","$location","$cookies","postRequestService",function(a,b,c,d){d.request("/api/epics/get/active/project/"+c.get("project")).then(function(b){console.log(b.data.status),a.epicCards=b.data.response})}]),app.controller("homeController",["$scope","$cookies","postRequestService",function(a,b,c){a.discussion=[{cardIndex:"abc-123",cardName:"First Card",cardType:"Standard",user:"Chuch Jones",message:"Te pro legimus gloriatur referrentur, altera impedit gloriatur eu quo, admodum consulatu id vim. Eu homero tempor eos, mea laoreet consetetur an. Vim diam oporteat moderatius ad. Mei cu mundi fabellas, usu mundi sanctus albucius ea. Eam at aeque erroribus omittantur, eam simul mediocritatem no, nulla dicant ornatus eu mei."},{cardIndex:"abc-456",cardName:"A longer Title",cardType:"Standard",user:"Lama Lee",message:"Te pro legimus gloriatur referrentur, altera impedit gloriatur eu quo, admodum consulatu id vim. Eu homero tempor eos, mea laoreet consetetur an. Vim diam oporteat moderatius ad. Mei cu mundi fabellas, usu mundi sanctus albucius ea. Eam at aeque erroribus omittantur, eam simul mediocritatem no, nulla dicant ornatus eu mei."},{cardIndex:"abc-789",cardName:"Wow, look at this long title.",cardType:"Epic",user:"Tim Tom",message:"Te pro legimus gloriatur referrentur, altera impedit gloriatur eu quo, admodum consulatu id vim. Eu homero tempor eos, mea laoreet consetetur an. Vim diam oporteat moderatius ad. Mei cu mundi fabellas, usu mundi sanctus albucius ea. Eam at aeque erroribus omittantur, eam simul mediocritatem no, nulla dicant ornatus eu mei."}],a.project={name:"Loading...",image:"0/default.jpg"},c.request("/api/page/home/project/"+b.get("project")).then(function(b){a.cards=b.data.response.cards,a.sprint=b.data.response.sprint,a.project=b.data.response.project,console.log(a.sprint)}),a.confirmSprintClosure=function(){var d=confirm("Are you sure you want to close the sprint?\nAny card not closed will be moved to the backlog.");d&&c.request("/api/sprint/close/"+a.sprint.id+"/project/"+b.get("project")).then(function(a){})},a.displayOpenSprint=!1,a.toggleOpenSprint=function(){a.displayOpenSprint=!a.displayOpenSprint},a.logout=function(){b.remove("token")}}]),app.controller("loginController",["$scope","$rootScope","$cookies","$location","postRequestService",function(a,b,c,d,e){a.login={},a.submit=function(){g()&&f()&&e.request("/api/admin/login",a.login).then(function(b){"success"===b.data.status?(console.log(b),d.url("/")):(console.log(b),a.failureMessage=b.data.response)})};var f=function(){return!(!a.login.password||a.login.password.length<6)||(a.failureMessage="Password must be at least 6 characters",!1)},g=function(){return!(!a.login.email||!a.loginForm.loginEmail.$valid)||(a.failureMessage="The email address provided is invalid",!1)}}]),app.controller("openSprintController",["$scope","$location","$route","$cookies","postRequestService",function(a,b,c,d,e){var f=["January","February","March","April","May","June","July","August","September","October","November","December"];a.sprint={name:"Sprint for "+f[(new Date).getMonth()],endDate:4,project:d.get("project")},a.cancel=function(){"/"===b.path()?c.reload():b.url("/")},a.open=function(){e.request("/api/sprint/open",a.sprint).then(function(a){c.reload()})}}]),app.controller("registerController",["$scope","$cookies","$location","postRequestService",function(a,b,c,d){a.register={},a.submit=function(){f()&&g()&&h()&&e()&&d.request("/api/admin/register",a.register).then(function(b){"success"===b.data.status?c.url("/create/project"):a.failureMessage=b.data.response})};var e=function(){return!a.register.password||a.register.password.length<6?(a.failureMessage="Password must be at least 6 characters",!1):a.register.password===a.passwordCheck||(a.failureMessage="The passwords don't match",!1)},f=function(){return!(!a.register.email||!a.registerForm.emailInput.$valid)||(a.failureMessage="The email address provided is invalid",!1)},g=function(){return!(!a.register.firstName||a.register.firstName.length<1)||(a.failureMessage="Please enter your first name.",!1)},h=function(){return!(!a.register.lastName||a.register.lastName.length<1)||(a.failureMessage="Please enter your last name.",!1)}}]),app.controller("selectProjectController",["$scope","$cookies","$location","postRequestService",function(a,b,c,d){d.request("/api/project/get/user").then(function(b){a.projects=b.data.response,a.projects.length<1&&(console.log("Fired"),c.url("/create/project"))}),a.select=function(a){var d=new Date,e=new Date(d.getFullYear()+1,d.getMonth(),d.getDate());b.put("project",a,{expires:e}),c.url("/")}}]),app.controller("setDetailsPanelController",["$scope","postRequestService",function(a,b){a.$watch("card.epicId",function(b){for(i=0;i<a.epics.length;i++)if(a.epics[i].id==b){console.log(a.epics[i].id),a.selectedEpic=a.epics[i];break}})}]),app.controller("setStepsPanelController",["$scope","postRequestService",function(a,b){a.addStep=function(){a.steps||(a.newCard.steps=[]),a.steps.push({stepTask:"",userId:0,stepStatus:"Open"})}}]),app.controller("sidebarInfoController",["$scope","$location",function(a,b){}]),app.controller("sidebarController",["$scope","$location",function(a,b){a.icons={epic:!1,sprint:!1,backlog:!1,archive:!1},a.expand=!1,a.toggleExpand=function(){a.expand=!a.expand,a.expand?(a.pos={width:"200px"},a.abs={left:"0"}):(a.pos={width:"50"},a.abs={left:"-200"})},a.$watch(function(){return b.path()},function(b){angular.forEach(a.icons,function(b,c){a.icons[c]=!1}),"/"===b?a.icons.home=!0:"/list/epics"===b?a.icons.epic=!0:"/list/sprint/current"===b?a.icons.sprint=!0:"/list/backlog"===b?a.icons.backlog=!0:"/list/archive"===b&&(a.icons.archive=!0)})}]),app.controller("sprintController",["$scope","$location","$cookies","postRequestService",function(a,b,c,d){d.request("/api/sprint/get/current_with_cards/project/"+c.get("project")).then(function(b){a.sprint=b.data.response}),a.addCardPrompt=!1,a.addCard=function(){a.addCardPrompt=!0}}]),app.directive("addCardToSprint",function(){return{restrict:"E",controller:"addCardToSprintController",scope:{display:"=",sprint:"="},templateUrl:"/res/components/directives/add-card-to-sprint/add-card-to-sprint.template.html"}}),app.directive("card",function(){return{restrict:"E",controller:"cardController",scope:{card:"="},templateUrl:"/res/components/directives/card/card.template.html"}}),app.directive("discussionBoard",function(){return{restrict:"E",scope:{discussion:"="},templateUrl:"/res/components/directives/discussion-board/discussion-board.template.html"}}),app.directive("epicLabel",function(){return{restrict:"E",scope:{epic:"="},templateUrl:"/res/components/directives/epic-label/epic-label.template.html"}}),app.directive("imageUpload",function(){return{restrict:"A",scope:{image:"="},link:function(a,b,c){var d=new FileReader;d.onload=function(b){a.image=b.target.result,a.$apply()},b.on("change",function(){d.readAsDataURL(b[0].files[0])})}}}),app.directive("openSprint",function(){return{restrict:"E",controller:"openSprintController",scope:{display:"="},templateUrl:"/res/components/directives/open-sprint/open-sprint.template.html",link:function(a,b,c){a.toggleDisplay=function(){a.display=!1}}}}),app.directive("projectImage",function(){return{restrict:"E",scope:{project:"="},templateUrl:"/res/components/directives/project-image/project-image.template.html"}}),app.directive("setDetailsPanel",function(){return{restrict:"E",controller:"setDetailsPanelController",scope:{card:"=",users:"=",statuses:"=",epics:"="},templateUrl:"/res/components/directives/set-details-panel/set-details-panel.template.html"}}),app.directive("setStepsPanel",function(){return{restrict:"E",controller:"setStepsPanelController",scope:{steps:"=",users:"=",statuses:"="},templateUrl:"/res/components/directives/set-steps-panel/set-steps-panel.template.html"}}),app.directive("sidebarInfo",function(){return{restrict:"E",controller:"sidebarInfoController",templateUrl:"/res/components/directives/sidebar/sidebar-info.template.html"}}),app.directive("sidebar",function(){return{restrict:"E",controller:"sidebarController",scope:{card:"="},templateUrl:"/res/components/directives/sidebar/sidebar.template.html"}});