var app=angular.module("app",["ngRoute","ngCookies"],["$locationProvider",function(a){a.html5Mode(!0)}]);app.service("postRequestService",["$http",function(a){this.request=function(b,c){var d=new FormData;return d.append("payload",JSON.stringify(c)),a.post(b,d,{withCredentials:!1,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(a){return console.log(a),a},function(a){console.log("postRequest: Error")})}}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{controller:"homeController",templateUrl:"/res/site/home/home.index.html"}).when("/list/sprint/current",{controller:"sprintController",templateUrl:"/res/site/sprint/sprint.index.html"}).when("/list/epics",{controller:"epicListingController",templateUrl:"/res/site/epic-listing/epic-listing.index.html"}).when("/card/:cardId",{controller:"cardDetailsController",templateUrl:"/res/site/card-details/card-details.index.html"}).when("/create/card/:cardType",{controller:"createCardController",templateUrl:"/res/site/create/create-card.index.html"}).when("/list/backlog",{controller:"backlogController",templateUrl:"/res/site/backlog/backlog.index.html"}).otherwise("/",{redirectTo:"/"})}]),app.controller("addCardToSprintController",["$scope","$location","$route","postRequestService",function(a,b,c,d){d.request("/api/cards/get/backlog").then(function(b){console.log(b),a.availableCards=b.data.response}),a.cancel=function(){c.reload()},a.cardId="",a.add=function(){api_url="/api/sprint/"+a.sprint.id+"/add/card/"+a.cardId,console.log(api_url),d.request(api_url)}}]),app.controller("backlogController",["$scope","$location","postRequestService",function(a,b,c){c.request("/api/cards/get/backlog").then(function(b){a.backlog=b.data.response}),a.viewCard=function(a){console.log("fired"),b.url("/card/"+a)}}]),app.controller("cardDetailsController",["$scope","$routeParams","postRequestService",function(a,b,c){c.request("/api/get/card/"+b.cardId).then(function(b){a.card=b.data.response}),a.editName=!1,a.toggleEditName=function(){a.updatedName={cardId:a.card.id,cardName:a.card.name},a.editName=!a.editName},a.saveName=function(){var b="/api/card/"+a.card.id+"/update/name";c.request(b,a.updatedName).then(function(b){a.card.name=b.data.response.name,a.editName=!1})},a.editDetails=!1,a.toggleEditDetails=function(){f(),d(),a.editDetails=!a.editDetails};var d=function(){var b;b="None"==a.card.points?null:parseInt(a.card.points),a.updatedDetails={cardId:a.card.id,cardType:a.card.type,epicId:a.card.epic.id,cardCreated:a.card.created,cardUpdated:a.card.updated,cardPoints:b,userId:a.card.poc.id,cardStatus:a.card.status}};a.saveDetails=function(){var b="/api/card/"+a.card.id+"/update/details";c.request(b,a.updatedDetails).then(function(b){var c=b.data.response;a.card.epic=c.epic,a.card.created=c.created,a.card.updated=c.updated,a.card.points=c.points,a.card.poc=c.poc,a.card.status=c.status,a.editDetails=!1})},a.editDescription=!1,a.toggleEditDescription=function(){a.updatedDescription={cardId:a.card.id,cardDescription:a.card.description},a.editDescription=!a.editDescription},a.saveDescription=function(){var b="/api/card/"+a.card.id+"/update/description";c.request(b,a.updatedDescription).then(function(b){a.card.description=b.data.response.description,a.editDescription=!1})},a.editSteps=!1,a.toggleEditSteps=function(){f(),e(),a.editSteps=!a.editSteps};var e=function(){for(a.updatedSteps=[],i=0;i<a.card.steps.length;i++)a.updatedSteps.push({stepId:a.card.steps[i].id,stepTask:a.card.steps[i].task,userId:a.card.steps[i].assigned.id,stepStatus:a.card.steps[i].status})};a.saveSteps=function(){var b="/api/card/"+a.card.id+"/update/steps";c.request(b,a.updatedSteps).then(function(b){a.card.steps=b.data.response,a.editSteps=!1})};var f=function(){a.users&&a.statuses&&a.epic||(a.epics=[a.card.epic],c.request("/api/page/create/card",a.newCard).then(function(b){a.statuses=b.data.response.statuses,unassigned=[{id:0,first_name:"Unassigned"}],a.users=unassigned.concat(b.data.response.users),a.epics=b.data.response.epics}))}}]),app.controller("cardController",["$scope",function(a){a.front=!0,a.toggleShow=function(){a.front=!a.front}}]),app.controller("createCardController",["$scope","$routeParams","postRequestService",function(a,b,c){a.newCard={cardIndex:"",cardName:"",cardType:b.cardType,cardCreated:new Date,cardUpdated:new Date,cardPoints:"",userId:0,cardStatus:"Open",cardDescription:"",epicId:"",epicBackgroundColor:"#ffffff",epicForegroundColor:"#000000",steps:[]},a.epic={id:0},a.$watch("newCard.epicBackgroundColor",function(b){"Epic"==a.newCard.cardType&&(a.epics[0].background_color=b)}),a.$watch("newCard.epicForegroundColor",function(b){"Epic"==a.newCard.cardType&&(a.epics[0].foreground_color=b)}),a.$watch("newCard.cardName",function(b){"Epic"==a.newCard.cardType&&(a.epics[0].name=b)}),a.$watch(a.epic,function(){a.newCard.epicId=a.epic.id}),a.epics=[{id:0,name:"None"}],c.request("/api/page/create/card",a.newCard).then(function(b){a.newCard.cardIndex=b.data.response.card_index,a.statuses=b.data.response.statuses,unassigned=[{id:0,first_name:"Unassigned"}],a.users=unassigned.concat(b.data.response.users),a.newCard.cardPoc=0,a.epics=a.epics.concat(b.data.response.epics)}),a.createCard=function(){c.request("/api/create/card",a.newCard).then(function(a){console.log("Create Card: You Probably Want to do something here")})}}]),app.controller("epicListingController",["$scope","$location","postRequestService",function(a,b,c){c.request("/api/epics/get/active").then(function(b){console.log(b.data.status),a.epicCards=b.data.response})}]),app.controller("homeController",["$scope","postRequestService",function(a,b){a.discussion=[{cardIndex:"abc-123",cardName:"First Card",cardType:"card",user:"Chuch Jones",message:"Te pro legimus gloriatur referrentur, altera impedit gloriatur eu quo, admodum consulatu id vim. Eu homero tempor eos, mea laoreet consetetur an. Vim diam oporteat moderatius ad. Mei cu mundi fabellas, usu mundi sanctus albucius ea. Eam at aeque erroribus omittantur, eam simul mediocritatem no, nulla dicant ornatus eu mei."},{cardIndex:"abc-456",cardName:"A longer Title",cardType:"card",user:"Lama Lee",message:"Te pro legimus gloriatur referrentur, altera impedit gloriatur eu quo, admodum consulatu id vim. Eu homero tempor eos, mea laoreet consetetur an. Vim diam oporteat moderatius ad. Mei cu mundi fabellas, usu mundi sanctus albucius ea. Eam at aeque erroribus omittantur, eam simul mediocritatem no, nulla dicant ornatus eu mei."}],b.request("/api/page/home").then(function(b){a.cards=b.data.response.cards,a.sprint=b.data.response.sprint,console.log(a.sprint.id)}),a.confirmSprintClosure=function(){var a=confirm("Are you sure you want to close the sprint?\nAny card not closed will be moved to the backlog.");a&&b.request("/api/sprint/close").then(function(a){})},a.displayOpenSprint=!1}]),app.controller("openSprintController",["$scope","$location","$route","postRequestService",function(a,b,c,d){var e=["January","February","March","April","May","June","July","August","September","October","November","December"];a.sprint={name:"Sprint for "+e[(new Date).getMonth()],endDate:4},a.cancel=function(){b.url("/"),c.reload()},a.open=function(){d.request("/api/sprint/open",a.sprint)}}]),app.controller("setDetailsPanelController",["$scope","postRequestService",function(a,b){a.$watch("card.epicId",function(b){for(i=0;i<a.epics.length;i++)if(a.epics[i].id==b){a.selectedEpic=a.epics[i];break}}),console.log(a.card),a.$watch("epics[0]",function(b){0==a.card.epicId&&(a.selectedEpic=a.epics[0])})}]),app.controller("setStepsPanelController",["$scope","postRequestService",function(a,b){a.addStep=function(){a.steps||(a.newCard.steps=[]),a.steps.push({stepTask:"",userId:0,stepStatus:"Open"})}}]),app.controller("sidebarController",["$scope","$location",function(a,b){a.abs,a.icons={epic:!1,sprint:!1,backlog:!1},a.expand=!1,a.toggleExpand=function(){a.expand=!a.expand,a.expand?(a.pos={width:"200px"},a.abs={left:"0"}):(a.pos={width:"50"},a.abs={left:"-200"})},a.$watch(function(){return b.path()},function(b){angular.forEach(a.icons,function(b,c){a.icons[c]=!1}),"/"===b?a.icons.home=!0:"/list/epics"===b?a.icons.epic=!0:"/list/sprint/current"===b?a.icons.sprint=!0:"/list/backlog"===b&&(a.icons.backlog=!0)})}]),app.controller("sprintController",["$scope","$location","postRequestService",function(a,b,c){c.request("/api/sprint/get/current_with_cards").then(function(b){a.sprint=b.data.response}),a.addCardPrompt=!1,a.addCard=function(){a.addCardPrompt=!0}}]),app.directive("addCardToSprint",function(){return{restrict:"E",controller:"addCardToSprintController",scope:{display:"=",sprint:"="},templateUrl:"/res/components/directives/add-card-to-sprint/add-card-to-sprint.template.html"}}),app.directive("card",function(){return{restrict:"E",controller:"cardController",scope:{card:"="},templateUrl:"/res/components/directives/card/card.template.html"}}),app.directive("discussionBoard",function(){return{restrict:"E",scope:{discussion:"="},templateUrl:"/res/components/directives/discussion-board/discussion-board.template.html"}}),app.directive("epicLabel",function(){return{restrict:"E",scope:{epic:"="},templateUrl:"/res/components/directives/epic-label/epic-label.template.html"}}),app.directive("openSprint",function(){return{restrict:"E",controller:"openSprintController",scope:{display:"="},templateUrl:"/res/components/directives/open-sprint/open-sprint.template.html",link:function(a,b,c){a.toggleDisplay=function(){a.display=!1}}}}),app.directive("projectImage",function(){return{restrict:"E",scope:{card:"="},templateUrl:"/res/components/directives/project-image/project-image.template.html"}}),app.directive("setDetailsPanel",function(){return{restrict:"E",controller:"setDetailsPanelController",scope:{card:"=",users:"=",statuses:"=",epics:"="},templateUrl:"/res/components/directives/set-details-panel/set-details-panel.template.html"}}),app.directive("setStepsPanel",function(){return{restrict:"E",controller:"setStepsPanelController",scope:{steps:"=",users:"=",statuses:"="},templateUrl:"/res/components/directives/set-steps-panel/set-steps-panel.template.html"}}),app.directive("sidebar",function(){return{restrict:"E",controller:"sidebarController",scope:{card:"="},templateUrl:"/res/components/directives/sidebar/sidebar.template.html"}});